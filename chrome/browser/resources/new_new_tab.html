<!DOCTYPE html>
<html i18n-values="dir:textdirection;firstview:firstview;bookmarkbarattached:bookmarkbarattached;hasattribution:hasattribution;anim:anim">

<meta charset="utf-8">
<title i18n-content="title"></title>
<script>
// Logging info for benchmarking purposes.
var log = [];
function logEvent(name) {
  log.push([name, Date.now()]);
}

var global = this;

/**
 * Registers a callback function so that if the backend calls it too early it
 * will get delayed until DOMContentLoaded is fired.
 * @param {string} name The name of the global function that the backend calls.
 */
function registerCallback(name) {
  var f = function(var_args) {
    var args = Array.prototype.slice.call(arguments);
    // If we still have the temporary function we delay until the dom is ready.
    if (global[name] == f) {
      logEvent(name + ' is not yet ready. Waiting for DOMContentLoaded');
      document.addEventListener('DOMContentLoaded', function() {
        logEvent('Calling the new ' + name);
        global[name].apply(null, args);
      });
    }
  };
  global[name] = f;
}

chrome.send('getShownSections');
chrome.send('getMostVisited');
chrome.send('getRecentlyClosedTabs');

registerCallback('onShownSections');
registerCallback('mostVisitedPages');
registerCallback('recentlyClosedTabs');
// TODO(arv): The backend calls this function. Remove the call on the backend.
function downloadsList() {}

logEvent('log start');

</script>
<link rel="stylesheet" href="new_new_tab.css">
<script>
// Until themes can clear the cache, force-reload the theme stylesheet.
document.write('<link id="themecss" rel="stylesheet" ' +
               'href="chrome://theme/css/newtab.css?' +
               (new Date()).getTime() + '">');
</script>
</head>
<body class="loading"
      i18n-values=".style.fontFamily:fontfamily;.style.fontSize:fontsize">

<div id="main">

  <div id="view-toolbar"
      ><input type=checkbox id="thumb-checkbox" checked
              i18n-values="title:showhidethumbnailtooltip"
      ><input type=checkbox id="list-checkbox"
              i18n-values="title:showhidelisttooltip"
      ><input type="button" id="option-button"
              i18n-values="title:pagedisplaytooltip"></div>

  <div id="option-menu" class="window-menu">
    <div command="show" section="THUMB" i18n-content="showthumbnails"
         style="display:none"></div>
    <div command="hide" section="THUMB" i18n-content="hidethumbnails"></div>
    <div command="show" section="LIST" i18n-content="showlist"></div>
    <div command="hide" section="LIST" i18n-content="hidelist"
         style="display:none"></div>
    <div command="show" section="RECENT" i18n-content="showrecentlyclosedtabs"
         style="display:none"></div>
    <div command="hide" section="RECENT"
         i18n-content="hiderecentlyclosedtabs"></div>
    <hr>
    <div command="clear-all-blacklisted"
         i18n-content="restorethumbnails"></div>
  </div>

  <div id="notification">
    <span>&nbsp;</span>
    <span><span class="link" tabindex="0"></span></span>
  </div>

  <div id="most-visited">
    <a class="thumbnail-container filler" tabindex="1" id="t0">
      <div class="edit-mode-border">
        <div class="edit-bar">
          <div class="pin"></div>
          <div class="spacer"></div>
          <div class="remove"></div>
        </div>
        <span class="thumbnail-wrapper">
          <span class="thumbnail"></span>
        </span>
      </div>
      <div class="title">
        <div></div>
      </div>
    </a>

    <a class="thumbnail-container filler" tabindex="1" id="t1">
      <div class="edit-mode-border">
        <div class="edit-bar">
          <div class="pin"></div>
          <div class="spacer"></div>
          <div class="remove"></div>
        </div>
        <span class="thumbnail-wrapper">
          <span class="thumbnail"></span>
        </span>
      </div>
      <div class="title">
        <div></div>
      </div>
    </a>

    <a class="thumbnail-container filler" tabindex="1" id="t2">
      <div class="edit-mode-border">
        <div class="edit-bar">
          <div class="pin"></div>
          <div class="spacer"></div>
          <div class="remove"></div>
        </div>
        <span class="thumbnail-wrapper">
          <span class="thumbnail"></span>
        </span>
      </div>
      <div class="title">
        <div></div>
      </div>
    </a>

    <a class="thumbnail-container filler" tabindex="1" id="t3">
      <div class="edit-mode-border">
        <div class="edit-bar">
          <div class="pin"></div>
          <div class="spacer"></div>
          <div class="remove"></div>
        </div>
        <span class="thumbnail-wrapper">
          <span class="thumbnail"></span>
        </span>
      </div>
      <div class="title">
        <div></div>
      </div>
    </a>

    <a class="thumbnail-container filler" tabindex="1" id="t4">
      <div class="edit-mode-border">
        <div class="edit-bar">
          <div class="pin"></div>
          <div class="spacer"></div>
          <div class="remove"></div>
        </div>
        <span class="thumbnail-wrapper">
          <span class="thumbnail"></span>
        </span>
      </div>
      <div class="title">
        <div></div>
      </div>
    </a>

    <a class="thumbnail-container filler" tabindex="1" id="t5">
      <div class="edit-mode-border">
        <div class="edit-bar">
          <div class="pin"></div>
          <div class="spacer"></div>
          <div class="remove"></div>
        </div>
        <span class="thumbnail-wrapper">
          <span class="thumbnail"></span>
        </span>
      </div>
      <div class="title">
        <div></div>
      </div>
    </a>

    <a class="thumbnail-container filler" tabindex="1" id="t6">
      <div class="edit-mode-border">
        <div class="edit-bar">
          <div class="pin"></div>
          <div class="spacer"></div>
          <div class="remove"></div>
        </div>
        <span class="thumbnail-wrapper">
          <span class="thumbnail"></span>
        </span>
      </div>
      <div class="title">
        <div></div>
      </div>
    </a>

    <a class="thumbnail-container filler" tabindex="1" id="t7">
      <div class="edit-mode-border">
        <div class="edit-bar">
          <div class="pin"></div>
          <div class="spacer"></div>
          <div class="remove"></div>
        </div>
        <span class="thumbnail-wrapper">
          <span class="thumbnail"></span>
        </span>
      </div>
      <div class="title">
        <div></div>
      </div>
    </a>

  </div>

  <div id="recently-closed">
    <h2 i18n-content="recentlyclosed"></h2>
    <span class="nav">
      <a href="chrome://history/" class="item"
          i18n-content="viewfullhistory"></a>
    </span>
  </div>

</div> <!-- main -->

<div>
  <div class="window-menu" id="window-tooltip">
    <span class="item" jsselect="$this"
        jsvalues=".style.backgroundImage:'url(&quot;chrome://favicon/' + url +
            '&quot;)';
            dir:direction;"
        jscontent="title"></span>
  </div>
</div>

<script src="local_strings.js"></script>
<script src="new_new_tab.js"></script>
</html>
