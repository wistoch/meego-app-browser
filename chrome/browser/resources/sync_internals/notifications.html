<script>
(function () {
function updateNotificationsEnabledInfo(notificationsEnabled) {
  var notificationsEnabledInfo =
    document.getElementById('notificationsEnabledInfo');
  jstProcess(
      new JsEvalContext({ 'notificationsEnabled': notificationsEnabled }),
      notificationsEnabledInfo);
}

function onLoad() {
  chrome.sync.getNotificationState(updateNotificationsEnabledInfo);
  chrome.sync.onSyncNotificationStateChange.addListener(
      updateNotificationsEnabledInfo);

  var notificationCounts = {};
  chrome.sync.onSyncIncomingNotification.addListener(function(changedTypes) {
    for (var i = 0; i < changedTypes.length; ++i) {
      var changedType = changedTypes[i];
      notificationCounts[changedType] = notificationCounts[changedType] || 0;
      ++notificationCounts[changedType];
    }

    var infos = [];
    for (var k in notificationCounts) {
      var info = { 'modelType': k, 'notificationCount': notificationCounts[k] };
      infos.push(info);
    }

    var notificationCountsInfo =
        document.getElementById('notificationCountsInfo');
    jstProcess(new JsEvalContext({ 'notificationCounts': infos }),
               notificationCountsInfo);
  });
}

document.addEventListener("DOMContentLoaded", onLoad, false);
})();
</script>

<style>
table#notificationCountsInfo tr:nth-child(odd) {
  background: #eff3ff;
}
</style>

<p id='notificationsEnabledInfo'>
  Enabled: <span jscontent='notificationsEnabled'></span>
</p>
<table id='notificationCountsInfo'>
  <tr jsselect='notificationCounts'>
    <td jscontent='modelType'/>
    <td jscontent='notificationCount'/>
  </tr>
</table>
