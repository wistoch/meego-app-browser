<html>
<head>
<script>
  // A dictionary keyed off of tabId that keeps track of data per tab (for
  // example what feedUrl was detected in the tab).
  var feedData = {};

  chrome.extension.onConnect.addListener(function(port) {
    var tab = port.sender.tab;

    // This will get called from the content script using PostMessage.
    // |feedUrls| is a list of URL feeds found on the page.
    port.onMessage.addListener(function(feedUrls) {
      feedData[tab.id] = feedUrls;
      if (feedUrls.length > 0) {
        chrome.pageAction.setTitle({ tabId: tab.id,
          title: "Click to subscribe..."
        });
        chrome.pageAction.show(tab.id);
      }
    });
  });

  chrome.tabs.onRemoved.addListener(function(reply) {
    feedData[reply.tabId] = null;
  });
</script>
</head>
</html>
