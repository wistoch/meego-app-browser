<html>
 <head>
  <script>
    var last_position = 0;
    var last_error = 0;
    var watch_id = 0;
    var alert_count = 0;
    var max_alert_count = undefined;
    function geoShowAlertIfNeeded(msg) {
      if (max_alert_count == undefined || alert_count++ < max_alert_count) {
        alert(msg);
      }
    }
    function geoSuccessCallback(position) {
      last_position = position;
      geoShowAlertIfNeeded('geoSuccessCallback');
    }
    function geoErrorCallback(error) {
      last_error = error;
      geoShowAlertIfNeeded('geoErrorCallback');
    }
    function geoStart() {
      watch_id = navigator.geolocation.watchPosition(
          geoSuccessCallback, geoErrorCallback,
          {maximumAge:600000, timeout:100000, enableHighAccuracy:true});
      return watch_id;
    }
    function geoGetLastPositionLatitude() {
      return "" + last_position.coords.latitude;
    }
    function geoGetLastPositionLongitude() {
      return "" + last_position.coords.longitude;
    }
    function geoGetLastError() {
      return "" + (last_error ? last_error.code : 0);
    }
    function geoSetMaxAlertCount(max_alerts) {
      alert_count = 0;
      max_alert_count = max_alerts;
      return "" + max_alert_count;
    }
    function geoAccessNavigatorGeolocation() {
      return "" + typeof(navigator.geolocation);
    }
  </script>
 </head>
 <body>
 <input type="button" value="manual" onclick="geoStart()"/>
 </body>
</html>

