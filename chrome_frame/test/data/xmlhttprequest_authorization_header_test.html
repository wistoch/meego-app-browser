<html>
  <head>
    <meta http-equiv="x-ua-compatible" content="chrome=1" />
    <title>ChromeFrame keyevent test</title>
    <script type="text/javascript"
        src="chrome_frame_tester_helpers.js"></script>

    <script type="text/javascript">
      function ValidateUserAgent() {
        if (isRunningInMSIE()) {
          onFailure("FullTab_XMLHttpRequestAuthorizationHeaderTest", 1,
                    "Failed");
        }

        SendXHRRequest();
      }

      function SendXHRRequest() {
        var xhr = getXHRObject();
        if (!xhr) {
          onFailure("FullTab_XMLHttpRequestAuthorizationHeaderTest", 1,
                    "Failed to get XHR object");
        }

        xhr.open("GET", "http://localhost:1337/echoheader?Authorization", false);
        xhr.setRequestHeader('Authorization', 'Basic');

        try {
          xhr.send(null);
          var pos = xhr.responseText.indexOf("Basic");
          if (pos >= 0) {
            appendStatus("Received authorization header: " + xhr.responseText);
            onSuccess("FullTab_XMLHttpRequestAuthorizationHeaderTest", 1);
          } else {
          onFailure("FullTab_XMLHttpRequestAuthorizationHeaderTest", 1,
                      "Failed to find authorization header in response.");
          }
        } catch (e) {
          appendStatus("XHR send failed. Error: " + e.description);
          onFailure("FullTab_XMLHttpRequestAuthorizationHeaderTest", 1,
                    "Failed to send XHR request");
        }
      }
    </script>
  </head>

  <body onLoad="setTimeout(ValidateUserAgent, 100);">
    ChromeFrame full tab mode XMLHttpRequest authorization header test.
    Verifies that authorization headers set by XML HTTP requests make it via
    the host network stack.
  </body>
</html>
