<html>
<head>
<style>
body {
  font-family: monospace;
}
table {
  border-collapse: collapse;
}
thead {
  border-top: solid 1px gray;
  border-left: solid 1px gray;
}
tbody {
  border-top: solid 1px gray;
  border-bottom: solid 1px gray;
  border-left: solid 1px gray;
}
th {
  text-align: center;
  border-right: solid 1px gray;
}
td {
  text-align: right;
  padding-left: 2em;
  padding-right: 0.5em;
  border-right: solid 1px gray;
}
tr.sep-top {
  border-top: solid 1px gray;
}
td.max-value {
  color: red;
}
</style>
<script src="js/common.js"></script>
<script>

function get_index_of_max(ary) {
  var max = ary[0];
  var result = 0;
  for (var i = 1; i < ary.length; ++i) {
    if (ary[i] > max) {
      max = ary[i];
      result = i;
    }
  }
  return result;
}

function received_data(data) {
  var tbody = document.getElementById("tbody");
  data.replace('\r', '');

  var col_sums = [];

  var rows = data.split('\n');
  for (var i = 0; i < rows.length; ++i) {
    var tr = document.createElement("TR");
    
    var cols = rows[i].split(' ');

    // cols[0] = page name
    // cols[1] = mean (minus worst run)
    // cols[2] = standard deviation (minus worst run)
    // cols[3...] = individual runs

    for (var j = 0; j < cols.length; ++j) {
      var td = document.createElement("TD");
      td.appendChild(document.createTextNode(cols[j]));
      tr.appendChild(td);
      if (j >= 1) {
        if (!col_sums[j - 1])
          col_sums[j - 1] = 0;
        col_sums[j - 1] = col_sums[j - 1] + (cols[j] - 0);
      }
    }

    tbody.appendChild(tr);
  }

  // print out the column totals (highlight the max value)

  var index_of_max = get_index_of_max(col_sums);

  var tr = document.createElement("TR");
  tr.setAttribute("class", "sep-top");

  var td = document.createElement("TD");
  td.appendChild(document.createTextNode("column totals"));
  tr.appendChild(td);

  for (var j = 0; j < col_sums.length; ++j) {
    td = document.createElement("TD");
    // don't display the summation of the stddev column since it is bogus
    if (j != 1) {
      if (j == index_of_max)
        td.setAttribute("class", "max-value");
      var precision = j == 0 ? 2 : 0;
      td.appendChild(document.createTextNode(col_sums[j].toFixed(precision)));
    }
    tr.appendChild(td);
  }

  tbody.appendChild(tr);
}

function init() {
  var cl = location.search.substring(4);
  Fetch(cl + ".dat", received_data); 
}

window.addEventListener("load", init, false);
</script>
</head>
<body>
<table>
  <thead>
    <tr><th>Page</th><th>Mean</th><th>StdDev</th><th colspan="10">Runs...</th></tr>
  </thead>
  <tbody id="tbody">
  </tbody>
</table>
</body>
</html>
